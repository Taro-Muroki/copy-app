<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AppID / PIN</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --head:#f3f4f6;

      /* コピー時の強調（濃いめ） */
      --flash:#1d4ed8;            /* 青 */
      --flashText:#ffffff;
      --flashOutline:#0b2a7a;
    }

    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;
      background:var(--bg);
      color:var(--text);
      overscroll-behavior-y: contain; /* 上下のみ気持ちよく */
    }

    /* 上部ヘッダー（薄く・小さく） */
    .topbar{
      position:sticky;
      top:0;
      z-index:10;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(180%) blur(12px);
      border-bottom:1px solid var(--line);
      padding:12px 14px;
    }
    .toprow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .title{
      font-weight:700;
      font-size:16px;
      letter-spacing:.2px;
      margin:0;
    }
    .count{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .wrap{
      max-width:780px;
      margin:0 auto;
      padding:10px 10px 16px;
    }

    /* コピー用は注意書き無し。ここは最低限だけ */
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      margin:10px 0 10px;
    }
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background:var(--card);
      border-radius:10px;
      padding:10px 12px;
      font-size:14px;
      font-weight:600;
    }
    .btn:active{ transform:scale(.99); }

    /* 横スクロールを殺す（これが重要） */
    .tablebox{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      overflow:hidden;          /* 横ズレ防止 */
    }
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;       /* 3列を必ず画面幅に収める */
      font-size:16px;
    }
    thead th{
      background:var(--head);
      border-bottom:1px solid var(--line);
      padding:12px 10px;
      text-align:left;
      font-size:13px;
      color:#374151;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    tbody td{
      border-bottom:1px solid var(--line);
      padding:14px 10px;
      vertical-align:middle;
      background:var(--card);
    }
    tbody tr:last-child td{ border-bottom:none; }

    /* 列幅：横スライド不要に最適化 */
    .col-n{ width:44px; text-align:right; padding-right:8px; color:var(--muted); font-variant-numeric:tabular-nums; }
    .col-id{ width:55%; font-variant-numeric:tabular-nums; }
    .col-pin{ width:45%; font-variant-numeric:tabular-nums; }

    /* 押せるセル */
    .tap{
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-weight:700;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      border-radius:10px;
      transition:background-color .12s ease, color .12s ease, box-shadow .12s ease;
    }
    .tap:active{
      transform:scale(.995);
    }

    /* コピー成功の強調（押したセルだけ付く） */
    .copied{
      background:var(--flash) !important;
      color:var(--flashText) !important;
      box-shadow:0 0 0 2px var(--flashOutline) inset;
    }

    /* 下部バー（そのまま残すなら） */
    .bottom{
      position:sticky;
      bottom:0;
      z-index:10;
      background:rgba(246,247,249,.92);
      backdrop-filter:saturate(180%) blur(12px);
      padding:10px 10px calc(12px + env(safe-area-inset-bottom));
      border-top:1px solid var(--line);
    }
    .bottomrow{
      display:flex;
      gap:10px;
      max-width:780px;
      margin:0 auto;
    }
    .input{
      flex:1;
      border:1px solid var(--line);
      background:var(--card);
      border-radius:12px;
      padding:12px 12px;
      font-size:16px;
      outline:none;
    }
    .copybtn{
      border:none;
      border-radius:12px;
      padding:12px 16px;
      font-size:16px;
      font-weight:800;
      background:#111827;
      color:#fff;
    }
    .copybtn:active{ transform:scale(.99); }

    /* 小さめ画面でも横ズレさせない */
    @media (max-width:420px){
      table{ font-size:15px; }
      .col-id{ width:56%; }
      .col-pin{ width:44%; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="toprow">
      <h1 class="title">AppID / PIN（入力＆コピー）</h1>
      <div class="count" id="countLabel">件数：0</div>
    </div>
  </header>

  <main class="wrap">
    <div class="actions">
      <button class="btn" id="btnReload" type="button">更新</button>
    </div>

    <div class="tablebox">
      <table aria-label="AppID PIN table">
        <thead>
          <tr>
            <th class="col-n">#</th>
            <th class="col-id">ID</th>
            <th class="col-pin">PIN</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </main>

  <footer class="bottom">
    <div class="bottomrow">
      <input class="input" id="bulkText" placeholder="ここにコピペ → 右のコピーでOK" />
      <button class="copybtn" id="btnCopy" type="button">コピー</button>
    </div>
  </footer>

  <script>
    // ===== サンプルデータ（ここをあなたのデータ読込に置き換えてもOK） =====
    // 既にあなたのコードで 62件出せてるので、data の作り方は今のままでOK。
    // ここでは最低限の形式にしてある。
    const data = [
      { id: "VMA1069413711", pin: "8p7s@3WD" },
      { id: "VMA1070117886", pin: "t7Sgn?i2" },
      { id: "VMA1070117924", pin: "wt?Cbg4A" },
      // ...（あなたの実データに置き換え）
    ];

    const tbody = document.getElementById("tbody");
    const countLabel = document.getElementById("countLabel");
    const btnReload = document.getElementById("btnReload");

    function setCount(n){
      countLabel.textContent = `件数：${n}`;
    }

    function haptic(){
      // iPhoneで効くことが多い（効かない環境もある）
      try { navigator.vibrate?.(25); } catch(e){}
    }

    async function copyText(text){
      // クリップボード API
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      // フォールバック（古い環境）
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly","");
      ta.style.position="fixed";
      ta.style.opacity="0";
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }

    function flashCell(cell){
      // “押したセルだけ”強調
      cell.classList.add("copied");
      setTimeout(()=>cell.classList.remove("copied"), 650);
    }

    function render(){
      tbody.innerHTML = "";
      data.forEach((row, idx) => {
        const tr = document.createElement("tr");

        const tdN = document.createElement("td");
        tdN.className = "col-n";
        tdN.textContent = String(idx + 1);

        const tdId = document.createElement("td");
        tdId.className = "col-id tap";
        tdId.textContent = row.id;

        const tdPin = document.createElement("td");
        tdPin.className = "col-pin tap";
        tdPin.textContent = row.pin;

        // IDだけ押したらIDだけ反応
        tdId.addEventListener("click", async () => {
          const ok = await copyText(row.id);
          if (ok) { haptic(); flashCell(tdId); }
        });

        // PINだけ押したらPINだけ反応
        tdPin.addEventListener("click", async () => {
          const ok = await copyText(row.pin);
          if (ok) { haptic(); flashCell(tdPin); }
        });

        tr.appendChild(tdN);
        tr.appendChild(tdId);
        tr.appendChild(tdPin);
        tbody.appendChild(tr);
      });

      setCount(data.length);
    }

    btnReload.addEventListener("click", () => {
      // 本当はここで fetch / localStorage 再読込など
      render();
    });

    // 下の「コピー」ボタン：入力欄の文字列をコピー（現状維持）
    document.getElementById("btnCopy").addEventListener("click", async () => {
      const v = document.getElementById("bulkText").value || "";
      if(!v) return;
      const ok = await copyText(v);
      if(ok){ haptic(); }
    });

    render();
  </script>
</body>
</html>
