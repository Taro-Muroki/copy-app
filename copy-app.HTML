<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AppID / PIN 入力＆コピー</title>
  <style>
    :root { --pad: 12px; --border:#d9d9d9; --bg:#fafafa; --ink:#111; }
    body{
      margin:0; font-family:-apple-system, system-ui, "Hiragino Sans", sans-serif;
      background:#fff; color:var(--ink);
      padding-bottom: 76px;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(255,255,255,.95);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid var(--border);
      padding: 10px var(--pad);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    header h1{ font-size:16px; margin:0; }
    header .mini{ font-size:12px; opacity:.7; }
    main{ padding: var(--pad); }
    .view{ display:none; }
    .view.active{ display:block; }

    .hint{ font-size:13px; opacity:.78; margin: 10px 2px 12px; line-height:1.45; }
    .tools{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin: 10px 0 12px; }
    .tools button{ width:auto; padding:10px 12px; font-size:14px; border-radius:12px; }

    button{
      border:1px solid var(--border);
      background:#111; color:#fff;
      padding: 10px 12px; border-radius:14px; font-size:15px;
    }
    button.secondary{ background:#fff; color:#111; }
    button.danger{ background:#fff; color:#b00020; border-color:#f0c4c4; }

    /* Table */
    .tableWrap{
      border:1px solid var(--border);
      border-radius:14px;
      overflow:auto;
      background:#fff;
      max-height: 70vh;
    }
    table{
      border-collapse:collapse;
      width:100%;
      min-width: 520px;
      font-size:15px;
    }
    th, td{
      border-bottom:1px solid var(--border);
      padding: 10px 10px;
      white-space:nowrap;
    }
    th{
      position:sticky; top:0;
      background: var(--bg);
      text-align:left;
      z-index:2;
    }
    td{ user-select:none; }
    tr:hover td{ background:#fcfcfc; }

    /* Excel-like editable cells (INPUT view) */
    td.editable{
      cursor:text;
      user-select:text;
    }
    td.editable:focus{
      outline:none;
      background:#e9f3ff;
      box-shadow: inset 0 0 0 2px rgba(122,167,255,.35);
    }

    /* Copy view cells */
    td.copyable{
      cursor:pointer;
      user-select:none;
    }
    td.copyable:active{ background:#e9f3ff; }

    /* Bottom tabs */
    nav{
      position:fixed; left:0; right:0; bottom:0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(255,255,255,.95);
      border-top:1px solid var(--border);
      display:flex; gap:10px;
      backdrop-filter:saturate(180%) blur(10px);
      z-index:20;
    }
    .tab{
      flex:1;
      border:1px solid var(--border);
      background:#fff;
      border-radius:16px;
      padding: 10px 0;
      font-size:15px;
    }
    .tab.active{ background:#111; color:#fff; border-color:#111; }

    /* Import box */
    textarea{
      width:100%;
      min-height: 150px;
      font-size:14px;
      border:1px solid var(--border);
      border-radius:14px;
      padding: 12px;
      box-sizing:border-box;
    }
    .card{
      border:1px solid var(--border); border-radius:14px;
      padding: 12px; background:#fff;
    }

    /* Toast */
    #toast{
      position:fixed; left:50%; bottom: 90px; transform:translateX(-50%);
      background: rgba(0,0,0,.82); color:#fff;
      padding:10px 14px; border-radius:999px;
      font-size:14px; display:none;
      z-index:30;
      max-width: calc(100% - 24px);
      text-align:center;
    }
    .muted{ opacity:.65; font-size:12px; }
  </style>
</head>

<body>
  <header>
    <div>
      <h1>AppID / PIN（入力＆コピー）</h1>
      <div class="mini">入力＝編集OK / コピー＝セルタップでコピー</div>
    </div>
    <div class="mini" id="count"></div>
  </header>

  <main>
    <!-- INPUT VIEW -->
    <section id="view-input" class="view active">
      <div class="card">
        <div class="hint">
          ✅ Excelの2列（AppID / PIN）をそのままコピーして、下に貼り付け →「取り込み」で一括登録できます。<br>
          形式：<strong>タブ区切り</strong>（Excel標準）or スペース区切りでもOK。<br>
          例：<code>VMA... [TAB] 8p7s...</code> が改行で続くイメージ
        </div>

        <textarea id="pasteBox" placeholder="ここにExcelからコピペ（2列×複数行）"></textarea>

        <div class="tools">
          <button id="btnImport">取り込み（追記）</button>
          <button class="secondary" id="btnReplace">取り込み（全置換）</button>
          <button class="secondary" id="btnExport">データをコピー（TSV）</button>
          <button class="danger" id="btnWipe">全削除</button>
        </div>

        <div class="muted">
          ・取り込み後は下の表でセル編集できます（Excelっぽい操作）<br>
          ・PINなど機密を扱うなら、このHTMLは他人に渡さないでください（端末内に保存されます）
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="hint">入力表（セルをタップして編集 / 行追加・削除あり）</div>
      <div class="tools">
        <button class="secondary" id="btnAddRow">行追加</button>
        <button class="secondary" id="btnSortAppId">AppIDで並び替え</button>
      </div>

      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th style="width:55px;">#</th>
              <th>AppID（編集可）</th>
              <th>PIN（編集可）</th>
              <th style="width:70px;">削除</th>
            </tr>
          </thead>
          <tbody id="tbodyInput"></tbody>
        </table>
      </div>
    </section>

    <!-- COPY VIEW -->
    <section id="view-copy" class="view">
      <div class="hint">
        表の<strong>セルをタップ</strong>すると、その<strong>セルの文字だけ</strong>をコピーします。<br>
        もしタップでコピーできない環境なら、セルを<strong>長押し→選択→コピー</strong>で代替できます。
      </div>

      <div class="tools">
        <button class="secondary" id="btnReload">更新</button>
      </div>

      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th style="width:55px;">#</th>
              <th>AppID（タップでコピー）</th>
              <th>PIN（タップでコピー）</th>
            </tr>
          </thead>
          <tbody id="tbodyCopy"></tbody>
        </table>
      </div>

      <div class="muted" style="margin-top:10px;">
        ・コピー画面は編集不可（セルタップ＝コピー専用）
      </div>
    </section>
  </main>

  <div id="toast"></div>

  <nav>
    <button id="tabInput" class="tab active">入力</button>
    <button id="tabCopy" class="tab">コピー</button>
  </nav>

<script>
(() => {
  const STORAGE_KEY = "appid_pin_table_v2";

  const $ = (id) => document.getElementById(id);

  const viewInput = $("view-input");
  const viewCopy  = $("view-copy");
  const tabInput  = $("tabInput");
  const tabCopy   = $("tabCopy");
  const toast     = $("toast");
  const countEl   = $("count");

  const pasteBox = $("pasteBox");
  const tbodyInput = $("tbodyInput");
  const tbodyCopy  = $("tbodyCopy");

  let data = loadData(); // [{id, appId, pin}]

  function showToast(msg) {
    toast.textContent = msg;
    toast.style.display = "block";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.style.display = "none", 900);
  }

  function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    updateCount();
  }

  function loadData() {
    try {
      const s = localStorage.getItem(STORAGE_KEY);
      return s ? JSON.parse(s) : [];
    } catch {
      return [];
    }
  }

  function updateCount() {
    countEl.textContent = `件数：${data.length}`;
  }

  function switchView(name) {
    const isInput = (name === "input");
    viewInput.classList.toggle("active", isInput);
    viewCopy.classList.toggle("active", !isInput);
    tabInput.classList.toggle("active", isInput);
    tabCopy.classList.toggle("active", !isInput);

    if (!isInput) renderCopy();
  }

  tabInput.addEventListener("click", () => switchView("input"));
  tabCopy.addEventListener("click",  () => switchView("copy"));

  async function copyText(text) {
    const t = String(text ?? "");
    if (!t) return;

    try {
      await navigator.clipboard.writeText(t);
      showToast("コピーしました");
      return;
    } catch (e) {
      try {
        const ta = document.createElement("textarea");
        ta.value = t;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.focus(); ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("コピーしました");
      } catch {
        showToast("コピー失敗：長押しでコピーしてください");
      }
    }
  }

  function newId() {
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function normalizeRow(r) {
    return {
      id: r.id ?? newId(),
      appId: (r.appId ?? "").toString(),
      pin: (r.pin ?? "").toString(),
    };
  }

  // ===== TSV / Paste Parse =====
  // Excelコピーは通常: "A\tB\nA\tB\n..."
  // 2列ない行はスキップ（または片側空欄で登録）
  function parsePaste(text) {
    const lines = (text || "")
      .replace(/\r\n/g, "\n")
      .replace(/\r/g, "\n")
      .split("\n");

    const rows = [];
    for (const line of lines) {
      const trimmed = line.trim();
      if (!trimmed) continue;

      // タブ優先 → なければ複数スペースで分割
      let parts = line.split("\t");
      if (parts.length < 2) parts = line.trim().split(/\s{2,}|\s+/);

      const appId = (parts[0] ?? "").trim();
      const pin   = (parts[1] ?? "").trim();

      if (!appId && !pin) continue;
      rows.push(normalizeRow({ appId, pin }));
    }
    return rows;
  }

  function toTSV(rows) {
    return rows.map(r => `${(r.appId ?? "")}\t${(r.pin ?? "")}`).join("\n");
  }

  // ===== Render INPUT (editable) =====
  function renderInput() {
    tbodyInput.innerHTML = "";

    data.forEach((r, idx) => {
      const tr = document.createElement("tr");

      const tdIdx = document.createElement("td");
      tdIdx.textContent = String(idx + 1);
      tdIdx.style.userSelect = "none";
      tr.appendChild(tdIdx);

      // AppID editable cell
      const tdA = document.createElement("td");
      tdA.className = "editable";
      tdA.contentEditable = "true";
      tdA.textContent = r.appId;
      tdA.addEventListener("input", () => {
        r.appId = tdA.textContent.trim();
        saveData();
      });
      tdA.addEventListener("keydown", (ev) => {
        // Excelっぽく Enterで次の行、Tabで次セル
        if (ev.key === "Enter") { ev.preventDefault(); focusCell(idx + 1, "appId"); }
      });
      tr.appendChild(tdA);

      // PIN editable cell
      const tdP = document.createElement("td");
      tdP.className = "editable";
      tdP.contentEditable = "true";
      tdP.textContent = r.pin;
      tdP.addEventListener("input", () => {
        r.pin = tdP.textContent.trim();
        saveData();
      });
      tdP.addEventListener("keydown", (ev) => {
        if (ev.key === "Enter") { ev.preventDefault(); focusCell(idx + 1, "pin"); }
      });
      tr.appendChild(tdP);

      // Delete button
      const tdDel = document.createElement("td");
      tdDel.style.textAlign = "center";
      const b = document.createElement("button");
      b.textContent = "削除";
      b.className = "secondary";
      b.style.width = "auto";
      b.style.padding = "8px 10px";
      b.style.borderRadius = "12px";
      b.addEventListener("click", (ev) => {
        ev.stopPropagation();
        data = data.filter(x => x.id !== r.id);
        saveData();
        renderInput();
        showToast("削除しました");
      });
      tdDel.appendChild(b);
      tr.appendChild(tdDel);

      tbodyInput.appendChild(tr);
    });

    updateCount();
  }

  function focusCell(rowIndex, field) {
    // rowIndexは data のインデックス（0-based）ではなく「次の行」用
    // ここではざっくり：次の行がなければ追加してフォーカス
    if (rowIndex >= data.length) {
      data.push(normalizeRow({ appId:"", pin:"" }));
      saveData();
      renderInput();
    }
    const tr = tbodyInput.children[rowIndex];
    if (!tr) return;
    const td = (field === "pin") ? tr.children[2] : tr.children[1];
    if (td) td.focus();
  }

  // ===== Render COPY (tap to copy) =====
  function renderCopy() {
    tbodyCopy.innerHTML = "";

    data.forEach((r, idx) => {
      const tr = document.createElement("tr");

      const tdIdx = document.createElement("td");
      tdIdx.textContent = String(idx + 1);
      tr.appendChild(tdIdx);

      const tdA = document.createElement("td");
      tdA.className = "copyable";
      tdA.textContent = r.appId;
      tdA.title = "タップでコピー";
      tdA.addEventListener("click", () => copyText(r.appId));
      tr.appendChild(tdA);

      const tdP = document.createElement("td");
      tdP.className = "copyable";
      tdP.textContent = r.pin;
      tdP.title = "タップでコピー";
      tdP.addEventListener("click", () => copyText(r.pin));
      tr.appendChild(tdP);

      tbodyCopy.appendChild(tr);
    });

    updateCount();
  }

  // ===== Buttons =====
  $("btnImport").addEventListener("click", () => {
    const rows = parsePaste(pasteBox.value);
    if (rows.length === 0) { showToast("取り込み対象がない"); return; }
    data = data.concat(rows);
    saveData();
    renderInput();
    showToast(`${rows.length}行 取り込み（追記）`);
  });

  $("btnReplace").addEventListener("click", () => {
    const rows = parsePaste(pasteBox.value);
    if (rows.length === 0) { showToast("取り込み対象がない"); return; }
    if (!confirm("全置換します。今のデータは消えます。いい？")) return;
    data = rows;
    saveData();
    renderInput();
    showToast(`${rows.length}行 取り込み（全置換）`);
  });

  $("btnExport").addEventListener("click", async () => {
    const tsv = toTSV(data);
    await copyText(tsv);
    alert("TSV（Excelに貼れる形式）をコピーしました。");
  });

  $("btnWipe").addEventListener("click", () => {
    if (!confirm("全データを削除します。いい？")) return;
    data = [];
    saveData();
    renderInput();
    showToast("全削除しました");
  });

  $("btnAddRow").addEventListener("click", () => {
    data.push(normalizeRow({ appId:"", pin:"" }));
    saveData();
    renderInput();
    showToast("行追加");
    // 追加した行のAppIDにフォーカス
    setTimeout(() => focusCell(data.length - 1, "appId"), 0);
  });

  $("btnSortAppId").addEventListener("click", () => {
    data.sort((a,b) => (a.appId || "").localeCompare(b.appId || ""));
    saveData();
    renderInput();
    showToast("AppIDで並び替え");
  });

  $("btnReload").addEventListener("click", () => {
    data = loadData();
    renderCopy();
    showToast("更新しました");
  });

  // ===== Init =====
  updateCount();
  renderInput();
})();
</script>
</body>
</html>
