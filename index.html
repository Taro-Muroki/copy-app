<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ID / PINï¼ˆå…¥åŠ›ï¼†ã‚³ãƒ”ãƒ¼ï¼‰</title>
  <style>
    /* --- COLA & FIZZ ULTRA THEME --- */
    :root{
      --colaRed: #e6002d;
      --colaDarkRed: #a3001e;
      --colaBrown: #2a0f0f;
      --colaLiquid: linear-gradient(to bottom, #4a1a1a, #2a0f0f);
      
      --iceWhite: rgba(255, 255, 255, 0.85);
      --iceFrost: rgba(255, 255, 255, 0.4);
      --iceBorder: rgba(255, 255, 255, 0.7);
      
      --bubbleBright: rgba(255, 255, 255, 0.9);
      --bubbleFizz: rgba(255, 255, 200, 0.4);

      --textMain: #3d1414;
      --textLight: #ffecec;
      --muted: #9e7070;

      /* ãƒœã‚¿ãƒ³ */
      --btnCrownBg: linear-gradient(135deg, #ff1a4a, #c40026);
      --btnIceBg: linear-gradient(to bottom, #ffffff, #e6f0ff);

      /* ã‚³ãƒ”ãƒ¼æ™‚ã®å¼·èª¿ï¼ˆå‡çµã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰ */
      --copiedFrostBg: rgba(200, 230, 255, 0.5);
      --copiedFrostBorder: rgba(150, 210, 255, 0.8);
      --copiedText: #004a80;

      /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
      --uiInputFont: 11.5px;
      --uiCopyFont:  15px;
      --uiInputScale: 0.71875;
      --colNum: 34px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    
    body{
      margin:0;
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background: var(--colaBrown);
      color: var(--textMain);
      overscroll-behavior-y: contain;
      position: relative;
      overflow-x: hidden;
      /* æ·±ã¿ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ©æ¶²ä½“ã®èƒŒæ™¯ */
      background-image: 
        radial-gradient(ellipse at center top, rgba(255, 50, 50, 0.2) 0%, transparent 60%),
        radial-gradient(ellipse at bottom right, rgba(200, 100, 50, 0.15) 0%, transparent 50%),
        linear-gradient(to bottom, #4a0a0a 0%, #1a0505 100%);
    }

    /* --- å¼·åŠ›ãªç‚­é…¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ --- */
    .fizz-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    
    /* æ³¡ã®å®šç¾©é–¢æ•°ï¼ˆCSSå¤‰æ•°ã§ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’è¡¨ç¾ã§ããªã„ãŸã‚ã€è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§æ¨¡æ“¬ï¼‰ */
    .bubble-set-1 {
      background-image: 
        radial-gradient(circle, var(--bubbleBright) 2px, transparent 4px),
        radial-gradient(circle, var(--bubbleFizz) 1px, transparent 2px);
      background-size: 40px 80px, 70px 130px;
      animation: fizzRising 6s infinite linear;
      opacity: 0.6;
    }
    .bubble-set-2 {
      background-image: 
        radial-gradient(circle, var(--bubbleBright) 3px, transparent 5px),
        radial-gradient(circle, var(--bubbleFizz) 1.5px, transparent 3px);
      background-size: 90px 150px, 50px 90px;
      background-position: 30px 0, 10px 0;
      animation: fizzRising 9s infinite linear;
      opacity: 0.4;
    }
    .bubble-set-3 { /* å¤§ããã‚†ã£ãã‚Šãªæ³¡ */
      background-image: radial-gradient(circle, rgba(255,255,255,0.2) 5px, transparent 8px);
      background-size: 200px 300px;
      background-position: 100px 0;
      animation: fizzRisingSlow 15s infinite linear;
    }

    @keyframes fizzRising {
      0% { transform: translateY(100vh) scale(0.8); }
      100% { transform: translateY(-20vh) scale(1.2); opacity: 0; }
    }
    @keyframes fizzRisingSlow {
      0% { transform: translateY(100vh) translateX(-20px); }
      50% { transform: translateY(40vh) translateX(20px); }
      100% { transform: translateY(-20vh) translateX(-20px); opacity: 0; }
    }

    /* --- UIæ§‹é€  --- */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 130px; /* ä¸‹éƒ¨ä½™ç™½ã‚’å°‘ã—åºƒã’ã‚‹ */
    }

    /* --- æ°·çµã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
    .glass-panel {
      background: var(--iceFrost);
      backdrop-filter: blur(16px) saturate(120%);
      -webkit-backdrop-filter: blur(16px) saturate(120%);
      border: 1px solid var(--iceBorder);
      box-shadow: 
        inset 0 1px 2px rgba(255,255,255,0.6), /* å†…å´ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        inset 0 -2px 5px rgba(0,0,0,0.05),     /* å†…å´ã®å½± */
        0 8px 32px rgba(0,0,0,0.2);            /* å¤–å´ã®ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦ */
      position: relative;
      overflow: hidden;
    }
    /* éœœã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .glass-panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
      pointer-events: none;
      mix-blend-mode: overlay;
      opacity: 0.3;
    }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 30;
      padding: 12px 14px 10px;
      margin: 0 -14px;
      border-radius: 0 0 24px 24px;
      border-top: none;
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      padding-bottom: 10px;
    }

    /* --- ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
    .btn{
      border:0;
      padding: 12px 16px;
      border-radius: 30px;
      font-weight: 800;
      cursor:pointer;
      user-select:none;
      line-height: 1;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      position: relative;
      transition: all 0.15s ease-out;
      text-shadow: 0 1px 1px rgba(0,0,0,0.1);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15), inset 0 2px 3px rgba(255,255,255,0.4);
    }
    .btn:active {
      transform: translateY(3px) scale(0.98);
      box-shadow: 0 1px 2px rgba(0,0,0,0.1), inset 0 1px 2px rgba(0,0,0,0.2);
    }
    
    /* ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®ç‚­é…¸å¼¾ã‘ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .btn::after {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 10px; height: 10px;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 20%, transparent 60%);
      border-radius: 50%;
      opacity: 0;
      transform: translate(-50%, -50%) scale(1);
      pointer-events: none;
    }
    .btn:active::after {
      animation: fizzPop 0.4s ease-out;
    }
    @keyframes fizzPop {
      0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(5); }
    }

    /* ç‹å† ãƒœã‚¿ãƒ³ï¼ˆä¿å­˜ï¼‰ */
    .btn.dark {
      background: var(--btnCrownBg);
      color: white;
      border: 2px solid #fff;
      box-shadow: 
        0 4px 0 #a3001e, /* ç«‹ä½“çš„ãªåšã¿ */
        0 8px 15px rgba(0,0,0,0.3);
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      /* ç‹å† ã®ã‚®ã‚¶ã‚®ã‚¶æ„Ÿã‚’è¡¨ç¾ */
      background-image: 
        linear-gradient(135deg, transparent 45%, #c40026 50%, transparent 55%),
        linear-gradient(45deg, transparent 45%, #c40026 50%, transparent 55%),
        var(--btnCrownBg);
      background-size: 10px 10px, 10px 10px, 100% 100%;
      background-repeat: repeat-x, repeat-x, no-repeat;
      background-position: 0 0, 5px 0, 0 0;
    }
    .btn.dark:active {
      transform: translateY(4px);
      box-shadow: 0 0 0 #a3001e, 0 2px 5px rgba(0,0,0,0.2);
    }

    /* æ°·/ãƒ—ãƒ«ã‚¿ãƒ–ãƒœã‚¿ãƒ³ */
    .btn.light, .btn.danger {
      background: var(--btnIceBg);
      color: var(--colaBrown);
      border: 1px solid rgba(255,255,255,0.8);
      box-shadow: 
        inset 0 2px 5px rgba(255,255,255,0.9),
        inset 0 -2px 5px rgba(200,220,255,0.3),
        0 4px 10px rgba(0,0,0,0.1);
    }
    .btn.danger {
      color: var(--colaRed);
      background: linear-gradient(to bottom, #fff0f0, #ffecec);
    }

    .btn.icon{
      width: 46px; height: 46px;
      padding: 0;
      font-size: 20px;
      border-radius: 50%; /* ä¸¸ã„æ°·ã®ã‚ˆã†ã« */
    }

    /* ãƒ•ã‚©ãƒ³ãƒˆãƒ‘ãƒãƒ« */
    .fontPanel{
      margin-top: 8px;
      padding: 16px;
      border-radius: 20px;
      background: rgba(255,255,255,0.95);
      border: 2px solid var(--colaRed);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      display:none;
      animation: slideDown 0.2s ease-out;
    }
    @keyframes slideDown{ from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }

    .fontRow{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 0;
    }
    .fontRow label{
      font-weight: 900;
      color: var(--colaBrown);
    }
    .fontRow input[type="range"]{ 
      flex:1; accent-color: var(--colaRed); height: 6px;
    }
    .fontVal{
      font-weight: 900;
      color: var(--colaRed);
      background: #fff0f0;
      padding: 4px 8px;
      border-radius: 10px;
    }

    /* --- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ --- */
    .card{
      border-radius: 28px;
      margin-top: 20px;
      /* ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ é©ç”¨ */
      @extend .glass-panel; 
    }

    .section{ padding: 20px; }

    .headerRow{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;
    }

    .hTitle{
      font-size: 24px;
      font-weight: 900;
      letter-spacing: .5px;
      color: var(--colaRed);
      /* ã‚³ãƒ¼ãƒ©ã®ãƒ­ã‚´ã£ã½ã„ç¸å–ã‚Šã¨å½± */
      -webkit-text-stroke: 1px white;
      text-shadow: 2px 2px 0px var(--colaBrown), 0 0 10px rgba(230,0,45,0.5);
      font-style: italic;
    }
    .count{
      font-size: 14px;
      color: var(--muted);
      font-weight: 800;
      background: rgba(255,255,255,0.5);
      padding: 4px 10px;
      border-radius: 12px;
    }

    .help{
      color: var(--textMain);
      font-size: 13px;
      line-height: 1.4;
      margin: 8px 0 16px;
      font-weight: 500;
      background: rgba(255, 250, 240, 0.6);
      padding: 10px;
      border-radius: 12px;
      border-left: 4px solid var(--colaRed);
    }

    /* å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆæ°·ã®æ¿ï¼‰ */
    .pasteBox{
      width:100%;
      border: 2px solid var(--iceBorder);
      border-radius: 18px;
      padding: 14px;
      font-size: 15px;
      line-height: 1.4;
      min-height: 100px;
      resize: vertical;
      outline: none;
      background: rgba(255,255,255,0.7);
      color: var(--colaBrown);
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      transition: all 0.2s;
    }
    .pasteBox:focus{
      border-color: var(--colaRed);
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 0 4px rgba(230,0,45,0.2), inset 0 1px 3px rgba(230,0,45,0.1);
    }

    .pasteActions{
      display:flex;
      gap: 12px;
      margin-top: 16px;
    }
    .pasteActions .btn{
      flex:1;
      padding: 14px;
      font-size: 16px;
    }

    /* --- ã‚°ãƒªãƒƒãƒ‰ï¼ˆãƒªã‚¹ãƒˆï¼‰ --- */
    .grid{
      width:100%;
      border: none;
      border-radius: 20px;
      overflow:hidden;
      /* ãƒªã‚¹ãƒˆå…¨ä½“ã‚‚æ°·ã®å¡Šã®ã‚ˆã†ã« */
      background: rgba(255,255,255,0.6);
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    .gridHeader, .gridRow{
      display:grid;
      grid-template-columns: var(--colNum) 1fr 0.78fr;
      align-items:center;
      column-gap: 12px;
      padding: 14px;
    }

    .gridHeader{
      background: linear-gradient(to right, rgba(255,240,240,0.9), rgba(255,255,255,0.8));
      border-bottom: 2px solid rgba(230,200,200,0.5);
      font-weight: 900;
      color: var(--colaRed);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .gridRow{
      border-bottom: 1px solid rgba(230,200,200,0.3);
      position: relative;
      background: transparent;
      transition: background 0.1s;
    }
    .gridRow:last-child{ border-bottom: 0; }
    .gridRow:hover { background: rgba(255,255,255,0.3); }

    .numCell{
      position: relative;
      height: 44px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      color: var(--muted);
    }
    .numGhost{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      font-size: 28px;
      opacity: 0.2;
      pointer-events:none;
    }
    .numFront{ position:relative; z-index:2; font-size: 13px; }

    .cellWrap{
      position: relative;
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 0;
    }

    /* å…¥åŠ›ã‚»ãƒ« */
    .cellInput{
      width:100%;
      border: 2px solid transparent;
      background: rgba(255,255,255,0.4);
      outline:none;
      padding: 10px 40px 10px 12px;
      border-radius: 16px;
      font-weight: 900;
      letter-spacing: .5px;
      color: var(--textMain);
      font-size: 16px;
      transition: all 0.2s;
    }
    .cellInput:focus{
      background: rgba(255,255,255,0.9);
      border-color: var(--colaRed);
      box-shadow: 0 0 10px rgba(230,0,45,0.2);
    }

    .view-input .cellWrap{
      transform: scale(var(--uiInputScale));
      transform-origin: left center;
      width: calc(100% / var(--uiInputScale));
    }
    .view-input .gridRow, .view-input .gridHeader{ font-size: var(--uiInputFont); }
    .view-copy .gridRow,  .view-copy .gridHeader{ font-size: var(--uiCopyFont); }

    .copyMini{
      position:absolute;
      right: 6px; top: 50%;
      transform: translateY(-50%);
      width: 32px; height: 32px;
      border-radius: 50%;
      border: 1px solid rgba(230,200,200,0.8);
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 16px;
      cursor:pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .copyMini:active{ transform: translateY(-50%) scale(0.9); background: var(--colaRed); color:white; border-color:transparent; }

    /* ã‚³ãƒ”ãƒ¼ç”¨ã‚¿ãƒƒãƒ—ã‚»ãƒ«ï¼ˆæ°·ã®å¡Šï¼‰ */
    .tapCell{
      padding: 12px;
      border-radius: 16px;
      font-weight: 900;
      letter-spacing: .5px;
      user-select: none;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor:pointer;
      font-size: var(--uiCopyFont);
      background: rgba(255,255,255,0.3);
      border: 1px solid transparent;
      transition: all 0.1s;
      font-family: monospace, serif; /* IDã£ã½ã•ã‚’å‡ºã™ */
    }
    .tapCell:active{ transform: scale(0.98); background: rgba(255,255,255,0.5); }

    /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆç‚­é…¸ãŒå¼¾ã‘ã‚‹ã‚ˆã†ãªé’ç™½ã„å…‰ï¼‰ */
    .flash{
      animation: flashEffect 0.6s ease-out;
    }
    @keyframes flashEffect {
      0% { background: white; outline: 4px solid #5aceff; box-shadow: 0 0 20px #5aceff; }
      100% { background: transparent; outline: 4px solid transparent; box-shadow: none; }
    }

    /* ã‚³ãƒ”ãƒ¼æ¸ˆã¿ï¼ˆå‡çµçŠ¶æ…‹ï¼‰ */
    .copiedMark{
      background: var(--copiedFrostBg) !important;
      border: 2px solid var(--copiedFrostBorder) !important;
      color: var(--copiedText) !important;
      text-shadow: 0 0 5px rgba(255,255,255,0.8);
      position: relative;
      overflow: hidden;
    }
    /* å‡çµã—ãŸã‚­ãƒ©ã‚­ãƒ©æ„Ÿ */
    .copiedMark::after {
      content: "";
      position: absolute;
      inset: -50%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.8), transparent);
      transform: rotate(45deg);
      animation: iceShimmer 2s infinite linear;
      opacity: 0.5;
      pointer-events: none;
    }
    @keyframes iceShimmer {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    /* --- ã‚¿ãƒ–ãƒãƒ¼ --- */
    .tabs{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 40;
      padding: 12px 14px calc(16px + env(safe-area-inset-bottom));
      border-radius: 28px 28px 0 0;
      border-top: none;
    }

    .tabBar{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      gap: 16px;
      background: rgba(0,0,0,0.1); /* ã‚¿ãƒ–ã®èƒŒæ™¯ã‚’å°‘ã—æš—ãã—ã¦æµ®ãå‡ºã•ã›ã‚‹ */
      padding: 6px;
      border-radius: 32px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .tabBtn{
      flex:1;
      border: none;
      border-radius: 24px;
      padding: 14px 0;
      font-weight: 950;
      font-size: 18px;
      cursor:pointer;
      background: transparent;
      color: var(--iceWhite);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .tabBtn.active{
      background: var(--btnCrownBg);
      color: white;
      box-shadow: 0 4px 15px rgba(230, 0, 45, 0.5), inset 0 2px 3px rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    /* --- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ --- */
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      bottom: calc(110px + env(safe-area-inset-bottom));
      /* ã‚³ãƒ¼ãƒ©ç¼¶ã®ã‚ˆã†ãªãƒ¡ã‚¿ãƒªãƒƒã‚¯ãªèµ¤ */
      background: linear-gradient(135deg, #e6002d, #a3001e);
      color:white;
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: 900;
      font-size: 15px;
      opacity: 0;
      pointer-events:none;
      transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1); /* å¼¾ã‚€ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      z-index: 60;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      border: 2px solid rgba(255,255,255,0.8);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    /* ãƒˆãƒ¼ã‚¹ãƒˆã«ç‚­é…¸ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ  */
    .toast::before { content: "âœ¨"; font-size: 18px; }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); }

  </style>
  <style>
    /* ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ã™ã‚‹ãŸã‚ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆSCSSã®@extendãŒä½¿ãˆãªã„ãŸã‚ï¼‰ */
    .topbar, .tabs {
      background: var(--iceFrost);
      backdrop-filter: blur(16px) saturate(120%);
      -webkit-backdrop-filter: blur(16px) saturate(120%);
      border: 1px solid var(--iceBorder);
      box-shadow: 
        inset 0 1px 2px rgba(255,255,255,0.6),
        inset 0 -2px 5px rgba(0,0,0,0.05),
        0 8px 32px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    .topbar::before, .tabs::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
      pointer-events: none;
      mix-blend-mode: overlay;
      opacity: 0.3;
    }
  </style>
</head>

<body>
  <div class="fizz-layer">
    <div class="fizz-layer bubble-set-1"></div>
    <div class="fizz-layer bubble-set-2"></div>
    <div class="fizz-layer bubble-set-3"></div>
  </div>

  <div class="wrap">

    <div class="topbar">
      <div class="controls">
        <button class="btn dark" id="btnSave">ä¿å­˜</button>
        <button class="btn light" id="btnLoad">èª­è¾¼</button>
        <button class="btn danger" id="btnClear">å…¨å‰Šé™¤</button>

        <button class="btn light" id="btnFont" title="æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´">Aï¼¡</button>

        <div style="flex:1"></div>

        <button class="btn icon light" id="btnBack" title="æˆ»ã‚‹">â†</button>
        <button class="btn icon light" id="btnFwd" title="é€²ã‚€">â†’</button>
      </div>

      <div class="fontPanel" id="fontPanel">
        <div class="fontRow">
          <label for="rngInputFont">å…¥åŠ›æ–‡å­—</label>
          <input id="rngInputFont" type="range" min="9" max="16" step="0.5" />
          <div class="fontVal" id="valInputFont"></div>
        </div>
        <div class="fontRow">
          <label for="rngCopyFont">ã‚³ãƒ”ãƒ¼æ–‡å­—</label>
          <input id="rngCopyFont" type="range" min="11" max="20" step="0.5" />
          <div class="fontVal" id="valCopyFont"></div>
        </div>
      </div>
    </div>

    <div id="viewInput" class="card section view-input" style="display:none;">
      <div class="headerRow">
        <div class="hTitle">INPUT DATA</div>
        <div class="count"><span id="countInput">0</span> ä»¶</div>
      </div>

      <div class="help">
        ã“ã“ã«ã€ŒID PINã€ã‚’è¤‡æ•°è¡Œã§è²¼ã‚Šä»˜ã‘ â†’ ã€Œè²¼ã‚Šä»˜ã‘åæ˜ ã€<br/>
        ï¼ˆExcelãªã©ã‹ã‚‰ãã®ã¾ã¾ã‚³ãƒ”ãƒšOKï¼‰
      </div>

      <textarea id="pasteArea" class="pasteBox" placeholder="ä¾‹ï¼šVMA1069413711 8p7s@3WD&#13;&#10;ä¾‹ï¼šAppID: 12345 / PIN: abcde"></textarea>

      <div class="pasteActions">
        <button class="btn dark" id="btnApply">è²¼ã‚Šä»˜ã‘åæ˜ </button>
        <button class="btn light" id="btnCopyTSV">TSVã‚³ãƒ”ãƒ¼</button>
      </div>

      <div style="height:20px"></div>

      <div class="headerRow" style="margin-bottom:10px;">
        <div class="hTitle" style="font-size:20px;">LIST PREVIEW</div>
        <div class="count"><span id="countTableInput">0</span> ä»¶</div>
      </div>

      <div class="grid" id="gridInput">
        <div class="gridHeader">
          <div>#</div>
          <div>ID</div>
          <div>PIN</div>
        </div>
        <div id="rowsInput"></div>
      </div>
    </div>

    <div id="viewCopy" class="card section view-copy" style="display:none;">
      <div class="headerRow">
        <div class="hTitle">TAP TO COPY</div>
        <div class="count"><span id="countCopy">0</span> ä»¶</div>
      </div>

      <div class="help" style="margin-bottom:16px; border-color: var(--colaRed);">
        ã‚»ãƒ«ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚³ãƒ”ãƒ¼ã€‚
        <span style="color:var(--colaRed); font-weight:bold;">1å›ç›®ã§å‡çµï¼ˆè‰²å¤‰åŒ–ï¼‰ã€2å›ç›®ã§è§£å‡ï¼ˆå…ƒã«æˆ»ã‚‹ï¼‰ã€‚</span>
      </div>

      <div class="grid" id="gridCopy">
        <div class="gridHeader">
          <div>#</div>
          <div>ID</div>
          <div>PIN</div>
        </div>
        <div id="rowsCopy"></div>
      </div>
    </div>

  </div>

  <div class="tabs">
    <div class="tabBar">
      <button class="tabBtn" id="tabInput">å…¥åŠ›</button>
      <button class="tabBtn" id="tabCopy">ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>

  <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>

  <script>
    const STORAGE_KEY = "idpin_app_v1";
    const SETTINGS_KEY = "idpin_app_settings_v1";
    const MAX_ROWS = 120;

    // row: { id, pin, editCount, lastCountedId, copiedId, copiedPin }
    let rows = [];

    let history = [];
    let histIdx = -1;

    const viewInput = document.getElementById("viewInput");
    const viewCopy  = document.getElementById("viewCopy");
    const tabInput  = document.getElementById("tabInput");
    const tabCopy   = document.getElementById("tabCopy");

    const btnSave   = document.getElementById("btnSave");
    const btnLoad   = document.getElementById("btnLoad");
    const btnClear  = document.getElementById("btnClear");
    const btnBack   = document.getElementById("btnBack");
    const btnFwd    = document.getElementById("btnFwd");

    const pasteArea = document.getElementById("pasteArea");
    const btnApply  = document.getElementById("btnApply");
    const btnCopyTSV= document.getElementById("btnCopyTSV");

    const rowsInput = document.getElementById("rowsInput");
    const rowsCopy  = document.getElementById("rowsCopy");

    const countInput = document.getElementById("countInput");
    const countCopy  = document.getElementById("countCopy");
    const countTableInput = document.getElementById("countTableInput");

    const toast = document.getElementById("toast");

    const btnFont = document.getElementById("btnFont");
    const fontPanel = document.getElementById("fontPanel");
    const rngInputFont = document.getElementById("rngInputFont");
    const rngCopyFont  = document.getElementById("rngCopyFont");
    const valInputFont = document.getElementById("valInputFont");
    const valCopyFont  = document.getElementById("valCopyFont");

    function showToast(msg="ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1500); // å°‘ã—é•·ã‚ã«è¡¨ç¤º
    }

    function clampRows(){
      if(rows.length > MAX_ROWS) rows = rows.slice(0, MAX_ROWS);
    }

    function ensureRow(i){
      while(rows.length <= i){
        rows.push({
          id:"", pin:"",
          editCount:0,
          lastCountedId:"",
          copiedId:false,
          copiedPin:false
        });
      }
    }

    function snapshot(){
      const snap = JSON.stringify(rows);
      if(histIdx >= 0 && history[histIdx] === snap) return;
      history = history.slice(0, histIdx + 1);
      history.push(snap);
      histIdx = history.length - 1;
      updateHistBtns();
    }

    function restoreFromHistory(targetIdx){
      if(targetIdx < 0 || targetIdx >= history.length) return;
      histIdx = targetIdx;
      rows = JSON.parse(history[histIdx]);
      renderAll();
      updateHistBtns();
    }

    function updateHistBtns(){
      btnBack.disabled = (histIdx <= 0);
      btnFwd.disabled  = (histIdx >= history.length - 1);
      btnBack.style.opacity = btnBack.disabled ? 0.4 : 1;
      btnFwd.style.opacity  = btnFwd.disabled  ? 0.4 : 1;
    }

    function nonEmptyCount(){
      return rows.filter(r => (r.id && r.id.trim()) || (r.pin && r.pin.trim())).length;
    }

    function toTSV(){
      const filtered = rows
        .filter(r => (r.id && r.id.trim()) || (r.pin && r.pin.trim()));
      return filtered.map((r, idx) => {
        const n = idx + 1;
        const id = r.id ?? "";
        const pin = r.pin ?? "";
        const c = r.editCount ?? 0;
        return `${n}\t${id}\t${pin}\t${c}`;
      }).join("\n");
    }

    async function writeClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        try{
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          ta.style.top = "-9999px";
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          return true;
        }catch(_){
          return false;
        }
      }
    }

    function flashEl(el){
      el.classList.add("flash");
      clearTimeout(el._flashT);
      el._flashT = setTimeout(()=>el.classList.remove("flash"), 600);
    }

    function colorForCount(n){
      const hue = (n * 37) % 360;
      // CSSå¤‰æ•°ã‹ã‚‰ç›´æ¥å–å¾—ã›ãšã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã§å¯¾å¿œï¼ˆJSå¤‰æ›´ä¸å¯ã®ãŸã‚ï¼‰
      const a = "0.15"; 
      return `hsla(${hue}, 70%, 40%, ${a})`;
    }

    function findInsertStart(){
      for(let i=0;i<rows.length;i++){
        const r = rows[i];
        const empty = (!r.id || !r.id.trim()) && (!r.pin || !r.pin.trim());
        if(empty) return i;
      }
      return rows.length;
    }

    function normalizeId(s){ return (s ?? "").trim().slice(0,13); }
    function normalizePin(s){ return (s ?? "").trim().slice(0,8); }

    function applyFontSettings(inputPx, copyPx){
      const root = document.documentElement;
      const inV = Number(inputPx);
      const cpV = Number(copyPx);
      if(Number.isFinite(inV)){
        root.style.setProperty("--uiInputFont", `${inV}px`);
        root.style.setProperty("--uiInputScale", String(inV / 16));
      }
      if(Number.isFinite(cpV)){
        root.style.setProperty("--uiCopyFont", `${cpV}px`);
      }
      valInputFont.textContent = `${Number(inputPx).toFixed(1)}`;
      valCopyFont.textContent  = `${Number(copyPx).toFixed(1)}`;
    }

    function saveSettings(inputPx, copyPx){
      const obj = { inputFont: Number(inputPx), copyFont: Number(copyPx) };
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(obj));
    }

    function loadSettings(){
      const s = localStorage.getItem(SETTINGS_KEY);
      if(!s) return { inputFont: 11.5, copyFont: 15 };
      try{
        const o = JSON.parse(s);
        const inputFont = Number(o?.inputFont);
        const copyFont  = Number(o?.copyFont);
        return {
          inputFont: Number.isFinite(inputFont) ? inputFont : 11.5,
          copyFont:  Number.isFinite(copyFont)  ? copyFont  : 15
        };
      }catch(_){
        return { inputFont: 11.5, copyFont: 15 };
      }
    }

    btnFont.addEventListener("click", ()=>{
      fontPanel.style.display = (fontPanel.style.display === "none" || !fontPanel.style.display) ? "block" : "none";
    });

    rngInputFont.addEventListener("input", ()=>{
      applyFontSettings(rngInputFont.value, rngCopyFont.value);
      saveSettings(rngInputFont.value, rngCopyFont.value);
    });
    rngCopyFont.addEventListener("input", ()=>{
      applyFontSettings(rngInputFont.value, rngCopyFont.value);
      saveSettings(rngInputFont.value, rngCopyFont.value);
    });

    function renderAll(){
      renderInputTable();
      renderCopyTable();
      countInput.textContent = String(nonEmptyCount());
      countTableInput.textContent = String(nonEmptyCount());
      countCopy.textContent = String(nonEmptyCount());
    }

    function renderInputTable(){
      rowsInput.innerHTML = "";
      const count = rows.length;

      for(let i=0;i<Math.max(count, 1);i++){
        ensureRow(i);
        const r = rows[i];

        const rowEl = document.createElement("div");
        rowEl.className = "gridRow";

        const num = document.createElement("div");
        num.className = "numCell";

        const ghost = document.createElement("div");
        ghost.className = "numGhost";
        ghost.textContent = String(r.editCount ?? 0);
        ghost.style.color = colorForCount(r.editCount ?? 0);

        const front = document.createElement("div");
        front.className = "numFront";
        front.textContent = String(i+1);

        num.appendChild(ghost);
        num.appendChild(front);

        const idWrap = document.createElement("div");
        idWrap.className = "cellWrap";
        const idInput = document.createElement("input");
        idInput.className = "cellInput";
        idInput.value = r.id ?? "";
        idInput.autocomplete = "off";
        idInput.spellcheck = false;
        idInput.maxLength = 13;

        const idCopy = document.createElement("button");
        idCopy.type = "button";
        idCopy.className = "copyMini";
        idCopy.textContent = "ğŸ“‹";
        idCopy.title = "IDã‚’ã‚³ãƒ”ãƒ¼";

        const pinWrap = document.createElement("div");
        pinWrap.className = "cellWrap";
        const pinInput = document.createElement("input");
        pinInput.className = "cellInput";
        pinInput.value = r.pin ?? "";
        pinInput.autocomplete = "off";
        pinInput.spellcheck = false;
        pinInput.maxLength = 8;

        const pinCopy = document.createElement("button");
        pinCopy.type = "button";
        pinCopy.className = "copyMini";
        pinCopy.textContent = "ğŸ“‹";
        pinCopy.title = "PINã‚’ã‚³ãƒ”ãƒ¼";

        function enableAutoSelectAll(inp){
          inp.addEventListener("pointerdown", ()=>{
            requestAnimationFrame(()=>{
              try{ inp.focus({preventScroll:true}); }catch(_){}
              setTimeout(()=>{ try{ inp.select(); }catch(_){} }, 0);
            });
          }, {passive:true});
          inp.addEventListener("focus", ()=>{
            setTimeout(()=>{ try{ inp.select(); }catch(_){} }, 0);
          });
        }
        enableAutoSelectAll(idInput);
        enableAutoSelectAll(pinInput);

        let idStartValue = r.id ?? "";
        idInput.addEventListener("focus", ()=>{ idStartValue = idInput.value ?? ""; });

        idInput.addEventListener("input", ()=>{
          r.id = normalizeId(idInput.value);
          r.copiedId = false;
        });

        idInput.addEventListener("blur", ()=>{
          const newVal = normalizeId(idInput.value);
          r.id = newVal;

          if(newVal !== idStartValue){
            if((r.lastCountedId ?? "") !== newVal){
              r.editCount = (r.editCount ?? 0) + 1;
              r.lastCountedId = newVal;
              ghost.textContent = String(r.editCount);
              ghost.style.color = colorForCount(r.editCount);
            }
            snapshot();
            renderCopyTable();
            countInput.textContent = String(nonEmptyCount());
            countTableInput.textContent = String(nonEmptyCount());
            countCopy.textContent = String(nonEmptyCount());
          }
        });

        pinInput.addEventListener("input", ()=>{
          r.pin = normalizePin(pinInput.value);
          r.copiedPin = false;
        });
        pinInput.addEventListener("blur", ()=>{
          r.pin = normalizePin(pinInput.value);
          snapshot();
          renderCopyTable();
          countInput.textContent = String(nonEmptyCount());
          countTableInput.textContent = String(nonEmptyCount());
          countCopy.textContent = String(nonEmptyCount());
        });

        idCopy.addEventListener("click", async ()=>{
          const ok = await writeClipboard(r.id ?? "");
          if(ok){
            flashEl(idInput);
            showToast("IDã‚’ã‚³ãƒ”ãƒ¼ï¼");
          }
        });
        pinCopy.addEventListener("click", async ()=>{
          const ok = await writeClipboard(r.pin ?? "");
          if(ok){
            flashEl(pinInput);
            showToast("PINã‚’ã‚³ãƒ”ãƒ¼ï¼");
          }
        });

        idWrap.appendChild(idInput);
        idWrap.appendChild(idCopy);
        pinWrap.appendChild(pinInput);
        pinWrap.appendChild(pinCopy);

        rowEl.appendChild(num);
        rowEl.appendChild(idWrap);
        rowEl.appendChild(pinWrap);

        rowsInput.appendChild(rowEl);
      }
    }

    function renderCopyTable(){
      rowsCopy.innerHTML = "";
      const filtered = rows
        .map((r,idx)=>({r,idx}))
        .filter(x => (x.r.id && x.r.id.trim()) || (x.r.pin && x.r.pin.trim()));

      if(filtered.length === 0){
        const rowEl = document.createElement("div");
        rowEl.className = "gridRow";
        rowEl.innerHTML = `
          <div class="numCell"><div class="numGhost" style="color:${colorForCount(0)}">0</div><div class="numFront">-</div></div>
          <div class="tapCell" style="color:var(--muted); background:transparent;">ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰</div>
          <div class="tapCell" style="background:transparent;"></div>
        `;
        rowsCopy.appendChild(rowEl);
        return;
      }

      for(let i=0;i<filtered.length;i++){
        const {r} = filtered[i];

        const rowEl = document.createElement("div");
        rowEl.className = "gridRow";

        const num = document.createElement("div");
        num.className = "numCell";

        const ghost = document.createElement("div");
        ghost.className = "numGhost";
        ghost.textContent = String(r.editCount ?? 0);
        ghost.style.color = colorForCount(r.editCount ?? 0);

        const front = document.createElement("div");
        front.className = "numFront";
        front.textContent = String(i+1);

        num.appendChild(ghost);
        num.appendChild(front);

        const idCell = document.createElement("div");
        idCell.className = "tapCell";
        idCell.textContent = r.id ?? "";
        if(r.copiedId) idCell.classList.add("copiedMark");

        const pinCell = document.createElement("div");
        pinCell.className = "tapCell";
        pinCell.textContent = r.pin ?? "";
        if(r.copiedPin) pinCell.classList.add("copiedMark");

        /* ã‚³ãƒ”ãƒ¼æ™‚ã®å‹•ä½œï¼ˆJSã¯ãã®ã¾ã¾ï¼‰ */
        idCell.addEventListener("click", async ()=>{
          const ok = await writeClipboard(r.id ?? "");
          if(ok){
            flashEl(idCell);
            r.copiedId = !r.copiedId;
            idCell.classList.toggle("copiedMark", r.copiedId);
            snapshot();
            showToast("IDã‚’ã‚³ãƒ”ãƒ¼ï¼");
          }
        });

        pinCell.addEventListener("click", async ()=>{
          const ok = await writeClipboard(r.pin ?? "");
          if(ok){
            flashEl(pinCell);
            r.copiedPin = !r.copiedPin;
            pinCell.classList.toggle("copiedMark", r.copiedPin);
            snapshot();
            showToast("PINã‚’ã‚³ãƒ”ãƒ¼ï¼");
          }
        });

        rowEl.appendChild(num);
        rowEl.appendChild(idCell);
        rowEl.appendChild(pinCell);

        rowsCopy.appendChild(rowEl);
      }
    }

    function stripPrefix(line, label){
      const re = new RegExp("^\\s*" + label + "\\s*[:ï¼š]\\s*", "i");
      return line.replace(re, "").trim();
    }
    function isAppIdLine(line){
      return /^\s*ã‚¢ãƒ—ãƒªID\s*[:ï¼š]/i.test(line) || /^\s*AppID\s*[:ï¼š]/i.test(line);
    }
    function isPinLine(line){
      return /^\s*PIN\s*[:ï¼š]/i.test(line);
    }

    function parsePasted(text){
      const lines = (text ?? "")
        .split(/\r?\n/)
        .map(s=>s.trim())
        .filter(Boolean);

      const out = [];

      for(let i=0;i<lines.length;i++){
        const line = lines[i];

        if(isAppIdLine(line) && (i+1) < lines.length && isPinLine(lines[i+1])){
          const idLabel = line.match(/^\s*AppID/i) ? "AppID" : "ã‚¢ãƒ—ãƒªID";
          const id = normalizeId(stripPrefix(line, idLabel));
          const pin = normalizePin(stripPrefix(lines[i+1], "PIN"));
          out.push({id, pin});
          i++;
          continue;
        }

        const parts = line.split(/\s+/);
        if(parts.length === 1){
          out.push({id: normalizeId(parts[0]), pin:""});
        }else{
          out.push({id: normalizeId(parts[0] ?? ""), pin: normalizePin(parts[1] ?? "")});
        }
      }

      return out;
    }

    btnApply.addEventListener("click", ()=>{
      const pasted = parsePasted(pasteArea.value);

      if(pasted.length === 0){
        showToast("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }

      const start = findInsertStart();

      for(let i=0;i<pasted.length;i++){
        const target = start + i;
        ensureRow(target);

        rows[target].id  = normalizeId(pasted[i].id ?? "");
        rows[target].pin = normalizePin(pasted[i].pin ?? "");

        rows[target].copiedId = false;
        rows[target].copiedPin = false;

        if((rows[target].lastCountedId ?? "") === ""){
          rows[target].lastCountedId = rows[target].id;
        }
      }

      clampRows();
      snapshot();
      renderAll();
      showToast("ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼");
    });

    btnCopyTSV.addEventListener("click", async ()=>{
      const tsv = toTSV();
      if(!tsv){
        showToast("ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      const ok = await writeClipboard(tsv);
      if(ok) showToast("TSVå½¢å¼ã§ã‚³ãƒ”ãƒ¼ï¼");
    });

    btnSave.addEventListener("click", ()=>{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
      showToast("ä¿å­˜ã—ã¾ã—ãŸï¼");
    });

    btnLoad.addEventListener("click", ()=>{
      const s = localStorage.getItem(STORAGE_KEY);
      if(!s){
        showToast("ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      try{
        rows = JSON.parse(s);
        if(!Array.isArray(rows)) rows = [];
        snapshot();
        renderAll();
        showToast("èª­è¾¼ã—ã¾ã—ãŸï¼");
      }catch(e){
        showToast("èª­è¾¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    });

    btnClear.addEventListener("click", ()=>{
      if(!confirm("æœ¬å½“ã«å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      rows = [];
      pasteArea.value = "";
      history = [];
      histIdx = -1;
      snapshot();
      renderAll();
      showToast("å…¨å‰Šé™¤ã—ã¾ã—ãŸï¼");
    });

    btnBack.addEventListener("click", ()=> restoreFromHistory(histIdx - 1));
    btnFwd.addEventListener("click",  ()=> restoreFromHistory(histIdx + 1));

    function setTab(which){
      const isInput = (which === "input");
      viewInput.style.display = isInput ? "" : "none";
      viewCopy.style.display  = isInput ? "none" : "";
      tabInput.classList.toggle("active", isInput);
      tabCopy.classList.toggle("active", !isInput);
    }
    tabInput.addEventListener("click", ()=> setTab("input"));
    tabCopy.addEventListener("click",  ()=> setTab("copy"));

    function init(){
      const s = localStorage.getItem(STORAGE_KEY);
      if(s){
        try{
          const loaded = JSON.parse(s);
          if(Array.isArray(loaded)) rows = loaded;
        }catch(_){}
      }

      const st = loadSettings();
      rngInputFont.value = String(st.inputFont);
      rngCopyFont.value  = String(st.copyFont);
      applyFontSettings(st.inputFont, st.copyFont);

      snapshot();
      renderAll();
      setTab("input");
    }
    init();
  </script>
</body>
</html>
